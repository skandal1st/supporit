# Создание первого администратора

## Быстрая инструкция

### Шаг 1: Зарегистрируйте пользователя

1. Убедитесь, что сервер запущен:
   ```bash
   cd server
   npm run dev
   ```

2. Убедитесь, что фронтенд запущен:
   ```bash
   npm run dev
   ```

3. Откройте браузер и перейдите на `http://localhost:5173/register`

4. Заполните форму регистрации:
   - **ФИО**: Ваше полное имя
   - **Email**: Ваш email адрес
   - **Пароль**: Надежный пароль

5. После успешной регистрации вы автоматически войдете в систему

**Примечание:** По умолчанию все новые пользователи получают роль `employee`. Для получения прав администратора выполните Шаг 2.

---

### Шаг 2: Назначьте роль администратора

После регистрации нужно изменить роль пользователя в базе данных. Есть несколько способов:

#### Способ 1: Через psql (рекомендуется)

1. Откройте терминал и подключитесь к PostgreSQL:

   **Linux/macOS:**
   ```bash
   PGPASSWORD='ваш_пароль' psql -U postgres -h localhost -d supporit
   ```
   
   **Windows:**
   ```bash
   psql -U postgres -d supporit
   ```

2. Выполните SQL-запрос (замените `your-email@example.com` на email, который вы использовали при регистрации):

   ```sql
   UPDATE users
   SET role = 'admin'
   WHERE email = 'skandal1inc@gmail.com';
   ```

3. Проверьте, что роль назначена:

   ```sql
   SELECT id, email, full_name, role FROM users WHERE email = 'skandal1inc@gmail.com';
   ```

   Должно быть: `role = 'admin'` (обратите внимание: роль должна быть в нижнем регистре - `admin`, а не `Admin`)

4. Выйдите из psql:
   ```sql
   \q
   ```

#### Способ 2: Через одну команду (без интерактивного psql)

**Linux/macOS:**
```bash
PGPASSWORD='ваш_пароль' psql -U postgres -h localhost -d supporit -c "UPDATE users SET role = 'admin' WHERE email = 'your-email@example.com';"
```

**Windows:**
```bash
psql -U postgres -d supporit -c "UPDATE users SET role = 'admin' WHERE email = 'your-email@example.com';"
```

#### Способ 3: Через SQL файл

1. Создайте файл `make_admin.sql`:
   ```sql
   UPDATE users
   SET role = 'admin'
   WHERE email = 'your-email@example.com';
   ```

2. Выполните файл:

   **Linux/macOS:**
   ```bash
   PGPASSWORD='ваш_пароль' psql -U postgres -h localhost -d supporit -f make_admin.sql
   ```

   **Windows:**
   ```bash
   psql -U postgres -d supporit -f make_admin.sql
   ```

---

### Шаг 3: Войдите в систему как администратор

1. Если вы еще не вошли, перейдите на страницу входа: `http://localhost:5173/login`

2. Введите email и пароль администратора

3. После входа вы будете перенаправлены на Dashboard с полными правами администратора

4. **Важно:** 
   - Если вы уже были залогинены, **обязательно выйдите и войдите снова**, чтобы получить новый токен с обновленной ролью
   - Система автоматически проверяет актуальную роль из базы данных, но для полной синхронизации рекомендуется перелогиниться

---

## Проверка прав доступа

После входа в систему как администратор вы должны видеть:

- ✅ Все пункты меню в боковой панели (включая "Пользователи" и "Отчеты")
- ✅ Полный доступ к Dashboard
- ✅ Кнопку "Добавить оборудование" на странице оборудования
- ✅ Кнопки "Редактировать" и "Удалить" для каждого элемента оборудования
- ✅ Возможность управлять заявками (когда модуль будет реализован)
- ✅ Доступ к отчетам и аналитике

---

## Назначение других ролей

### Назначение роли ИТ-специалиста

Роль `it_specialist` имеет права на управление оборудованием и заявками, но не может управлять пользователями:

```sql
UPDATE users
SET role = 'it_specialist'
WHERE email = 'user-email@example.com';
```

### Назначение роли обычного сотрудника

```sql
UPDATE users
SET role = 'employee'
WHERE email = 'user-email@example.com';
```

---

## Список всех пользователей и их ролей

Чтобы посмотреть всех пользователей в системе:

```sql
SELECT id, email, full_name, role, department, created_at 
FROM users 
ORDER BY created_at DESC;
```

---

## Решение проблем

### Проблема: "Peer authentication failed"

Если возникает ошибка при подключении к PostgreSQL, используйте TCP/IP подключение с паролем:

```bash
PGPASSWORD='ваш_пароль' psql -U postgres -h localhost -d supporit
```

Подробнее см. `server/SETUP_POSTGRES.md`

### Проблема: Пользователь не найден

1. Проверьте, что пользователь зарегистрирован:
   ```sql
   SELECT * FROM users WHERE email = 'your-email@example.com';
   ```

2. Если пользователь не найден, зарегистрируйтесь через форму регистрации на `http://localhost:5173/register`

### Проблема: Роль не обновилась после изменения в БД

1. **Проверьте, что роль правильно установлена в БД:**
   ```sql
   SELECT email, role FROM users WHERE email = 'your-email@example.com';
   ```
   Роль должна быть в **нижнем регистре**: `admin`, а не `Admin` или `ADMIN`

2. **Выйдите из системы** (кнопка "Выйти" в правом верхнем углу)

3. **Войдите снова** - это создаст новый токен с актуальной ролью

4. **Если проблема сохраняется:**
   - Убедитесь, что сервер перезапущен после изменения кода
   - Проверьте логи сервера на наличие ошибок
   - Система автоматически проверяет актуальную роль из БД, но перелогин гарантирует обновление токена

### Проблема: Нет доступа к некоторым страницам

Убедитесь, что:
- Роль правильно установлена в базе данных
- Вы вышли и вошли снова после изменения роли
- Сервер перезапущен (если нужно)

---

## Важные замечания

- ⚠️ **По умолчанию все новые пользователи получают роль `employee`**
- ⚠️ **Только администратор может изменять роли других пользователей** (через SQL или через интерфейс после реализации модуля управления пользователями)
- ⚠️ **Роль `admin` дает полный доступ ко всем функциям системы**
- ⚠️ **Роль `it_specialist` может управлять оборудованием и заявками, но не пользователями**
- ⚠️ **Роль `employee` может только просматривать оборудование и создавать заявки**

---

## Дополнительная информация

- Подробная инструкция по настройке PostgreSQL: `server/SETUP_POSTGRES.md`
- Основная документация проекта: `README.md`
- Схема базы данных: `supabase/schema_postgres.sql`
